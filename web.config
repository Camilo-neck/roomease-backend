<?xml version="1.0" encoding="UTF-8"?>

<!-- 
	Configuration for this node application to deploy in azure with windows server (IIS).
	the indes file is in /src/index.ts
-->

<configuration>
  <system.webServer>
	<handlers>
	  <add name="iisnode" path="src/index.ts" verb="*" modules="iisnode" />
	</handlers>
	<rewrite>
	  <rules>
		<rule name="LogFile" patternSyntax="ECMAScript" stopProcessing="true">
		  <match url="iisnode" />
		</rule>
		<rule name="NodeInspector" patternSyntax="ECMAScript" stopProcessing="true">
		  <match url="^src/index.ts\/debug[\/]?" />
		</rule>
		<rule name="StaticContent">
		  <action type="Rewrite" url="public{REQUEST_URI}" />
		</rule>
		<rule name="DynamicContent">
		  <conditions>
			<add input="{REQUEST_FILENAME}" matchType="IsFile" negate="True" />
		  </conditions>
		  <action type="Rewrite" url="src/index.ts" />
		</rule>
	  </rules>
	</rewrite>
	<security>
	  <requestFiltering>
		<hiddenSegments>
		  <remove segment="bin" />
		</hiddenSegments>
	  </requestFiltering>
	</security>
	<httpErrors existingResponse="PassThrough" />
	<iisnode node_env="production" />
  </system.webServer>
</configuration>